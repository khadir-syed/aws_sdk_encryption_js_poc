/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"). You may not use
 * this file except in compliance with the License. A copy of the License is
 * located at
 *
 *     http://aws.amazon.com/apache2.0/
 *
 * or in the "license" file accompanying this file. This file is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 * implied. See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* This is a simple example of using a raw AES keyring
 * to encrypt and decrypt using the AWS Encryption SDK for Javascript
 * in a browser.
 */
import { RawAesWrappingSuiteIdentifier, RawAesKeyringWebCrypto, encrypt, decrypt, synchronousRandomValues } from '@aws-crypto/client-browser';
import { toBase64 } from '@aws-sdk/util-base64-browser';
/* This is done to facilitate testing. */
export async function testAES() {
    /* You need to specify a name
     * and a namespace for raw encryption key providers.
     * The name and namespace that you use in the decryption keyring *must* be an exact,
     * *case-sensitive* match for the name and namespace in the encryption keyring.
     */
    const keyName = 'aes-name';
    const keyNamespace = 'aes-namespace';
    /* The wrapping suite defines the AES-GCM algorithm suite to use. */
    const wrappingSuite = RawAesWrappingSuiteIdentifier.AES256_GCM_IV12_TAG16_NO_PADDING;
    // Get your plaintext master key from wherever you store it.
    const unencryptedMasterKey = synchronousRandomValues(32);
    /* Import the plaintext master key into a WebCrypto CryptoKey. */
    const masterKey = await RawAesKeyringWebCrypto.importCryptoKey(unencryptedMasterKey, wrappingSuite);
    /* Configure the Raw AES keyring. */
    const keyring = new RawAesKeyringWebCrypto({ keyName, keyNamespace, wrappingSuite, masterKey });
    /* Encryption context is a *very* powerful tool for controlling and managing access.
     * It is ***not*** secret!
     * Encrypted data is opaque.
     * You can use an encryption context to assert things about the encrypted data.
     * Just because you can decrypt something does not mean it is what you expect.
     * For example, if you are are only expecting data from 'us-west-2',
     * the origin can identify a malicious actor.
     * See: https://docs.aws.amazon.com/encryption-sdk/latest/developer-guide/concepts.html#encryption-context
     */
    const context = {
        stage: 'demo',
        purpose: 'simple demonstration app',
        origin: 'us-west-2'
    };
    /* Find data to encrypt. */
    const plainText = new Uint8Array([1, 2, 3, 4, 5]);
    /* Encrypt the data. */
    const { result } = await encrypt(keyring, plainText, { encryptionContext: context });
    /* Log the plain text
     * only for testing and to show that it works.
     */
    console.log('plainText:', plainText);
    document.write('</br>plainText:' + plainText + '</br>');
    /* Log the base64-encoded result
     * so that you can try decrypting it with another AWS Encryption SDK implementation.
     */
    const resultBase64 = toBase64(result);
    console.log(resultBase64);
    document.write(resultBase64);
    const { plaintext, messageHeader } = await decrypt(keyring, result);
    /* Grab the encryption context so you can verify it. */
    const { encryptionContext } = messageHeader;
    /* Verify the encryption context.
     * If you use an algorithm suite with signing,
     * the Encryption SDK adds a name-value pair to the encryption context that contains the public key.
     * Because the encryption context might contain additional key-value pairs,
     * do not add a test that requires that all key-value pairs match.
     * Instead, verify that the key-value pairs you expect match.
     */
    Object
        .entries(context)
        .forEach(([key, value]) => {
        if (encryptionContext[key] !== value)
            throw new Error('Encryption Context does not match expected values');
    });
    /* Log the clear message
     * only for testing and to show that it works.
     */
    document.write('</br>plaintext:' + plaintext);
    console.log(plaintext);
    /* Return the values to make testing easy. */
    return { plainText, plaintext };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWVzX3NpbXBsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hZXNfc2ltcGxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7O0dBYUc7QUFFSDs7O0dBR0c7QUFFSCxPQUFPLEVBQ0wsNkJBQTZCLEVBQzdCLHNCQUFzQixFQUN0QixPQUFPLEVBQ1AsT0FBTyxFQUNQLHVCQUF1QixFQUN4QixNQUFNLDRCQUE0QixDQUFBO0FBQ25DLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUV2RCx5Q0FBeUM7QUFDekMsTUFBTSxDQUFDLEtBQUssVUFBVSxPQUFPO0lBQzNCOzs7O09BSUc7SUFDSCxNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUE7SUFDMUIsTUFBTSxZQUFZLEdBQUcsZUFBZSxDQUFBO0lBRXBDLG9FQUFvRTtJQUNwRSxNQUFNLGFBQWEsR0FBRyw2QkFBNkIsQ0FBQyxnQ0FBZ0MsQ0FBQTtJQUVwRiw0REFBNEQ7SUFDNUQsTUFBTSxvQkFBb0IsR0FBRyx1QkFBdUIsQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUV4RCxpRUFBaUU7SUFDakUsTUFBTSxTQUFTLEdBQUcsTUFBTSxzQkFBc0IsQ0FBQyxlQUFlLENBQUMsb0JBQW9CLEVBQUUsYUFBYSxDQUFDLENBQUE7SUFFbkcsb0NBQW9DO0lBQ3BDLE1BQU0sT0FBTyxHQUFHLElBQUksc0JBQXNCLENBQUMsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFBO0lBRS9GOzs7Ozs7OztPQVFHO0lBQ0gsTUFBTSxPQUFPLEdBQUc7UUFDZCxLQUFLLEVBQUUsTUFBTTtRQUNiLE9BQU8sRUFBRSwwQkFBMEI7UUFDbkMsTUFBTSxFQUFFLFdBQVc7S0FDcEIsQ0FBQTtJQUVELDJCQUEyQjtJQUMzQixNQUFNLFNBQVMsR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBRWpELHVCQUF1QjtJQUN2QixNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxPQUFPLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxFQUFFLGlCQUFpQixFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUE7SUFFcEY7O09BRUc7SUFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUNwQyxRQUFRLENBQUMsS0FBSyxDQUFDLGlCQUFpQixHQUFHLFNBQVMsR0FBRyxPQUFPLENBQUMsQ0FBQTtJQUV2RDs7T0FFRztJQUNILE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUNyQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFBO0lBQ3pCLFFBQVEsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUE7SUFFNUIsTUFBTSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsR0FBRyxNQUFNLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFFbkUsdURBQXVEO0lBQ3ZELE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxHQUFHLGFBQWEsQ0FBQTtJQUUzQzs7Ozs7O09BTUc7SUFDSCxNQUFNO1NBQ0gsT0FBTyxDQUFDLE9BQU8sQ0FBQztTQUNoQixPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFO1FBQ3hCLElBQUksaUJBQWlCLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSztZQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsbURBQW1ELENBQUMsQ0FBQTtJQUM1RyxDQUFDLENBQUMsQ0FBQTtJQUVKOztPQUVHO0lBQ0gsUUFBUSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsR0FBRyxTQUFTLENBQUMsQ0FBQTtJQUM3QyxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBRXRCLDZDQUE2QztJQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxDQUFBO0FBQ2pDLENBQUMifQ==